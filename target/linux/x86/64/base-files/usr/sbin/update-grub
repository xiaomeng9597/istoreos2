#!/bin/sh

GRUB_CFG=/boot/grub/grub.ext.cfg

merge_cfg() {
	local cfgfile
	echo "# Merged /etc/grub.cfg.d/*.cfg"
	echo "# WARNING: Do not edit this file by tools other than update-grub!!!"
	ls /etc/grub.cfg.d/*.cfg | while read; do
		cfgfile="$REPLY"
		echo "# $cfgfile"
		cat "$cfgfile"
		echo
	done
}

exec 512>/var/lock/update-grub.lock
flock 512 || exit 1

merge_cfg >$GRUB_CFG
